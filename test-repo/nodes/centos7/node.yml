node_map:
  cluster1:
    hosts:
      - 192.168.122.50
      - 192.168.122.51
    fabruns:
      - test/base

haproxy:
  cluster_map:
    cluster1:
      hosts: ${#node_map.cluster1.hosts}
      rings:
        - bindnetaddr: 192.168.122.0
          mcastport: 5405
          nodes:
            - 192.168.122.50
            - 192.168.122.51
      vip: 192.168.122.55
      cidr_netmask: 24
      monitor_interval: 30
      defaults:
        - mode                    http
        - log                     global
        - option                  httplog
        - option                  dontlognull
        - option http-server-close
        - option forwardfor       except 127.0.0.0/8
        - option                  redispatch
        - retries                 3
        - timeout http-request    10s
        - timeout queue           1m
        - timeout connect         10s
        - timeout client          1m
        - timeout server          1m
        - timeout http-keep-alive 10s
        - timeout check           10s
        - maxconn                 3000
        - balance source
      listens:
        - name: horizon
          port: 443
          option: tcpka
          option: httpchk
          option: tcplog
          servers:
           - controller1 10.0.0.1:443 check inter 2000 rise 2 fall 5
           - controller2 10.0.0.2:443 check inter 2000 rise 2 fall 5
           - controller3 10.0.0.3:443 check inter 2000 rise 2 fall 5
        - name: glance-api
          port: 9292
          option: tcpka
          option: httpchk
          option: tcplog
          servers:
           - controller1 10.0.0.1:443 check inter 2000 rise 2 fall 5
           - controller2 10.0.0.2:443 check inter 2000 rise 2 fall 5
           - controller3 10.0.0.3:443 check inter 2000 rise 2 fall 5
        - name: mysql
          port: 3306
          servers:
            - controller1 10.0.0.1:3306 check port 9200 inter 2000 rise 2 fall 5
            - controller2 10.0.0.2:3306 backup check port 9200 inter 2000 rise 2 fall 5
            - controller3 10.0.0.3:3306 backup check port 9200 inter 2000 rise 2 fall 5
