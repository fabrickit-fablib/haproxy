node_map:
  cluster1:
    hosts:
      - 192.168.122.50
      - 192.168.122.51
    fabruns:
      - test/base

haproxy:
  cluster_map:
    cluster1:
      hosts: ${#node_map.cluster1.hosts}
      rings:
        - bindnetaddr: 192.168.122.0
          mcastport: 5405
          nodes:
            - 192.168.122.50
            - 192.168.122.51
      vip: 192.168.122.55
      cidr_netmask: 24
      monitor_interval: 30
      defaults:
        - mode                    http
        - log                     global
        - option                  httplog
        - option                  dontlognull
        - option http-server-close
        - option forwardfor       except 127.0.0.0/8
        - option                  redispatch
        - retries                 3
        - timeout http-request    10s
        - timeout queue           1m
        - timeout connect         10s
        - timeout client          1m
        - timeout server          1m
        - timeout http-keep-alive 10s
        - timeout check           10s
        - maxconn                 3000
        - balance source
      hastats:
        enable: true
        port: 49999
        auth:
          user: admin
          pass: adminpass
      listens:
        - name: horizon
          port: 40080
          options:
            - option tcpka
            - option httpchk
            - option tcplog
          servers:
           - ctl1 192.168.122.50:80 check inter 2000 rise 2 fall 5
           - ctl2 192.168.122.51:80 check inter 2000 rise 2 fall 5
        - name: mysql
          port: 43306
          servers:
           - ctl1 192.168.122.50:3306 check inter 2000 rise 2 fall 5
           - ctl2 192.168.122.51:3306 check inter 2000 rise 2 fall 5
